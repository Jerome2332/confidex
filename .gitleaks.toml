# Gitleaks Configuration for Confidex
# https://github.com/gitleaks/gitleaks
#
# This file configures secret scanning to prevent accidental commits of:
# - API keys, tokens, and passwords
# - Private keys (Solana, SSH, etc.)
# - Environment secrets
#
# Run manually: gitleaks detect --source . --verbose

title = "Confidex Gitleaks Configuration"

[extend]
# Use default gitleaks rules as base
useDefault = true

[allowlist]
description = "Global allowlist for known safe patterns"

# Files to skip entirely
paths = [
  '''pnpm-lock\.yaml$''',
  '''package-lock\.json$''',
  '''yarn\.lock$''',
  '''\.test\.ts$''',
  '''\.spec\.ts$''',
  '''__tests__/''',
  '''__mocks__/''',
  '''\.md$''',
  '''circuits/.*\.json$''',
  '''target/''',
]

# Known safe patterns (public program IDs, test fixtures)
regexes = [
  # Solana Program IDs (these are public addresses, not secrets)
  '''63bxUBrBd1W5drU5UMYWwAfkMX7Qr17AZiTrm3aqfArB''',  # confidex_dex
  '''HrAjvetNk3UYzsrnbSEcybpQoTTSS8spZZFkiVWmWLbS''',  # confidex_mxe
  '''9op573D8GuuMAL2btvsnGVo2am2nMJZ4Cjt2srAkiG9W''',  # eligibility_verifier
  '''Arcj82pX7HxYKLR92qvgZUAd7vGS1k4hQvAFcPATFdEQ''',  # Arcium Core
  '''Gh9ZwEmdLJ8DscKNTkTqPbNwLNNBjuSzaG9Vp2KGtKJr''',  # Dummy USDC mint
  '''So11111111111111111111111111111111111111112''',    # Wrapped SOL
  '''TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA''',   # Token Program
  '''ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL''',  # Associated Token Program

  # Test/example patterns
  '''example[_-]?(key|secret|token|password)''',
  '''test[_-]?(key|secret|token|password)''',
  '''dummy[_-]?(key|secret|token|password)''',
  '''placeholder''',
  '''YOUR_.*_HERE''',
  '''<.*>''',  # Placeholder brackets like <API_KEY>

  # MXE X25519 public key (public, not a secret)
  '''46589a2f72e04b041864f84900632a8a017173ddc002f37d5ab3c7a69e1a1f1b''',
]

# Commits to skip (known historical commits with false positives)
commits = []

# Stop words that indicate false positives
stopwords = [
  "example",
  "sample",
  "test",
  "dummy",
  "placeholder",
  "CHANGEME",
  "TODO",
]

# Custom rules for Solana-specific patterns
[[rules]]
id = "solana-private-key-array"
description = "Solana private key in JSON array format [byte, byte, ...]"
regex = '''\[\s*\d{1,3}(?:\s*,\s*\d{1,3}){63}\s*\]'''
tags = ["key", "solana", "critical"]
keywords = ["secret", "private", "keypair", "wallet"]

[[rules]]
id = "solana-private-key-base58"
description = "Solana private key in base58 format (88 chars)"
regex = '''[1-9A-HJ-NP-Za-km-z]{87,88}'''
tags = ["key", "solana", "critical"]
keywords = ["secret", "private", "keypair"]
# Only flag if near sensitive keywords to reduce false positives
entropy = 4.5

[[rules]]
id = "env-file-secret"
description = "Secret value in environment variable assignment"
regex = '''(?i)(api[_-]?key|secret[_-]?key|private[_-]?key|password|token|auth)\s*[:=]\s*['"]?[A-Za-z0-9+/=_-]{20,}['"]?'''
path = '''\.env'''
tags = ["secret", "env"]

[[rules]]
id = "helius-api-key"
description = "Helius API key in URL"
regex = '''helius-rpc\.com/\?api-key=[a-f0-9-]{36}'''
tags = ["key", "helius"]

[[rules]]
id = "triton-credentials"
description = "Triton RPC credentials"
regex = '''rpcpool\.com/[a-f0-9-]{36}'''
tags = ["key", "triton"]

# Severity configuration
[rules.allowlist]
# Lower severity for documentation examples
paths = [
  '''README\.md$''',
  '''CLAUDE\.md$''',
  '''docs/''',
  '''project-docs/''',
]
